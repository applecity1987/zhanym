<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî Zhanym</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#0d0d1a;min-height:100vh;padding-bottom:80px}
.header{background:rgba(0,0,0,.6);padding:15px 20px;display:flex;justify-content:space-between;align-items:center;backdrop-filter:blur(10px);position:fixed;top:0;width:100%;z-index:100}
.logo{font-size:22px;font-weight:bold;color:white;text-decoration:none}
.nav a{margin-left:12px;text-decoration:none;color:rgba(255,255,255,.7);font-size:13px;padding:6px 14px;border-radius:20px;border:1px solid rgba(255,255,255,.2)}
.nav a:hover{background:rgba(255,255,255,.1)}

.container{max-width:500px;margin:0 auto;padding:75px 20px 20px}

/* HERO */
.hero{border-radius:24px;overflow:hidden;position:relative;margin-bottom:20px;background:linear-gradient(135deg,#1a1a2e,#2d1b3d)}
.hero-photo{width:100%;height:320px;object-fit:cover;display:flex;align-items:center;justify-content:center;font-size:100px;cursor:pointer;position:relative}
.hero-photo img{width:100%;height:100%;object-fit:cover}
.hero-gradient{position:absolute;bottom:0;left:0;right:0;height:50%;background:linear-gradient(to top,rgba(0,0,0,.9),transparent)}
.hero-info{position:absolute;bottom:20px;left:20px;right:20px}
.hero-name{font-size:28px;font-weight:900;color:white}
.hero-city{color:rgba(255,255,255,.7);font-size:14px;margin-top:4px}
.edit-photo-btn{position:absolute;top:15px;right:15px;background:rgba(0,0,0,.6);color:white;border:none;border-radius:20px;padding:8px 15px;font-size:13px;cursor:pointer;backdrop-filter:blur(5px)}

/* STATS */
.stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:20px}
.stat{background:rgba(255,255,255,.05);border-radius:16px;padding:15px;text-align:center;border:1px solid rgba(255,255,255,.1)}
.stat h3{font-size:24px;font-weight:900;color:#ff4458}
.stat p{font-size:11px;color:rgba(255,255,255,.5);margin-top:3px}

/* –§–û–¢–û –°–ï–¢–ö–ê */
.section{background:rgba(255,255,255,.05);border-radius:20px;padding:20px;margin-bottom:15px;border:1px solid rgba(255,255,255,.1)}
.section-title{font-size:16px;font-weight:bold;color:white;margin-bottom:15px;display:flex;align-items:center;gap:8px}
.photo-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.photo-slot{aspect-ratio:3/4;border:2px dashed rgba(255,255,255,.2);border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;background:rgba(255,255,255,.03);transition:.2s}
.photo-slot:hover{border-color:#ff4458}
.photo-slot .plus{width:32px;height:32px;background:linear-gradient(135deg,#ff4458,#fd79a8);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:18px;font-weight:bold;position:absolute;bottom:6px;right:6px}
.photo-slot img{width:100%;height:100%;object-fit:cover}
.del-btn{position:absolute;top:5px;right:5px;background:rgba(255,0,0,.8);color:white;border:none;border-radius:50%;width:24px;height:24px;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}

/* –§–û–†–ú–ê */
.group{margin-bottom:15px}
label{display:block;font-size:12px;color:rgba(255,255,255,.5);margin-bottom:6px;font-weight:bold;text-transform:uppercase;letter-spacing:.5px}
input,select,textarea{width:100%;padding:13px 15px;border:2px solid rgba(255,255,255,.1);border-radius:12px;font-size:15px;outline:none;transition:.3s;background:rgba(255,255,255,.05);color:white}
input:focus,select:focus,textarea:focus{border-color:#ff4458}
select option{background:#1a1a2e}
textarea{height:90px;resize:none}
.btn{width:100%;padding:16px;background:linear-gradient(135deg,#ff4458,#fd79a8);color:white;border:none;border-radius:50px;font-size:17px;font-weight:bold;cursor:pointer;margin-top:5px;transition:.2s}
.btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,68,88,.4)}
.btn-logout{width:100%;padding:13px;background:rgba(255,255,255,.05);color:rgba(255,255,255,.6);border:1px solid rgba(255,255,255,.1);border-radius:50px;font-size:15px;cursor:pointer;margin-top:10px}
.success{background:rgba(0,200,100,.2);color:#00c864;padding:10px 15px;border-radius:10px;margin-bottom:15px;font-size:14px;display:none;border:1px solid rgba(0,200,100,.3)}

/* BOTTOM NAV */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:rgba(13,13,26,.95);display:flex;justify-content:center;gap:30px;padding:10px 0 20px;border-top:1px solid rgba(255,255,255,.1);z-index:40}
.bottom-nav a{display:flex;flex-direction:column;align-items:center;gap:4px;text-decoration:none;color:rgba(255,255,255,.5);font-size:11px}
.bottom-nav a.active,.bottom-nav a:hover{color:#ff6b6b}
.bottom-nav a span{font-size:22px}
</style>
</head>
<body>

<div class="header">
  <a href="/" class="logo">üåπ Zhanym</a>
  <div class="nav">
    <a href="/dashboard">üî• –õ–µ–Ω—Ç–∞</a>
    <a href="/chat">üí¨ –ß–∞—Ç</a>
  </div>
</div>

<div class="container">

  <!-- HERO –§–û–¢–û -->
  <div class="hero">
    <div class="hero-photo" id="heroPhoto">
      <span id="heroEmoji">üë§</span>
    </div>
    <div class="hero-gradient"></div>
    <div class="hero-info">
      <div class="hero-name" id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      <div class="hero-city" id="profileCity">üìç</div>
    </div>
    <button class="edit-photo-btn" onclick="document.getElementById('mainPhotoInput').click()">üì∑ –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ</button>
  </div>
  <input type="file" id="mainPhotoInput" accept="image/*" style="display:none" onchange="uploadMainPhoto(this)">

  <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
  <div class="stats">
    <div class="stat"><h3 id="likesCount">0</h3><p>–õ–∞–π–∫–æ–≤</p></div>
    <div class="stat"><h3 id="matchesCount">0</h3><p>–ü–∞—Ä</p></div>
    <div class="stat"><h3 id="daysCount">1</h3><p>–î–Ω–µ–π</p></div>
  </div>

  <!-- –°–ï–¢–ö–ê –§–û–¢–û -->
  <div class="section">
    <div class="section-title">üì∏ –ú–æ–∏ —Ñ–æ—Ç–æ <span style="color:rgba(255,255,255,.4);font-size:13px;font-weight:normal" id="photoCountText">0/6</span></div>
    <div class="photo-grid" id="photoGrid">
      <div class="photo-slot" onclick="triggerSlot(0)" id="slot0"><div class="plus">+</div></div>
      <div class="photo-slot" onclick="triggerSlot(1)" id="slot1"><div class="plus">+</div></div>
      <div class="photo-slot" onclick="triggerSlot(2)" id="slot2"><div class="plus">+</div></div>
      <div class="photo-slot" onclick="triggerSlot(3)" id="slot3"><div class="plus">+</div></div>
      <div class="photo-slot" onclick="triggerSlot(4)" id="slot4"><div class="plus">+</div></div>
      <div class="photo-slot" onclick="triggerSlot(5)" id="slot5"><div class="plus">+</div></div>
    </div>
    <input type="file" id="slotPhotoInput" accept="image/*" style="display:none" onchange="uploadSlotPhoto(this)">
  </div>

  <!-- –§–û–†–ú–ê -->
  <div class="section">
    <div class="section-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</div>
    <div class="success" id="success">‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω!</div>
    <div class="group"><label>–ò–º—è</label><input type="text" id="name" placeholder="–¢–≤–æ—ë –∏–º—è"></div>
    <div class="group"><label>–í–æ–∑—Ä–∞—Å—Ç</label><input type="number" id="age" placeholder="25" min="18" max="99"></div>
    <div class="group"><label>–ì–æ—Ä–æ–¥</label>
      <select id="city">
        <option value="">–í—ã–±–µ—Ä–∏ –≥–æ—Ä–æ–¥</option>
        <option>–ê–ª–º–∞—Ç—ã</option><option>–ê—Å—Ç–∞–Ω–∞</option><option>–®—ã–º–∫–µ–Ω—Ç</option>
        <option>“ö–∞—Ä–∞“ì–∞–Ω–¥—ã</option><option>–ê“õ—Ç”©–±–µ</option><option>–¢–∞—Ä–∞–∑</option>
        <option>–ü–∞–≤–ª–æ–¥–∞—Ä</option><option>”®—Å–∫–µ–º–µ–Ω</option><option>–°–µ–º–µ–π</option>
        <option>–ê—Ç—ã—Ä–∞—É</option><option>“ö–æ—Å—Ç–∞–Ω–∞–π</option><option>“ö—ã–∑—ã–ª–æ—Ä–¥–∞</option>
        <option>–û—Ä–∞–ª</option><option>–ü–µ—Ç—Ä–æ–ø–∞–≤–ª</option><option>–ê“õ—Ç–∞—É</option>
        <option>–¢–µ–º–∏—Ä—Ç–∞—É</option><option>–¢“Ø—Ä–∫—ñ—Å—Ç–∞–Ω</option><option>–ö”©–∫—à–µ—Ç–∞—É</option>
        <option>–¢–∞–ª–¥—ã“õ–æ—Ä“ì–∞–Ω</option><option>–ï–∫—ñ–±–∞—Å—Ç“±–∑</option>
      </select>
    </div>
    <div class="group"><label>–ü–æ–ª</label>
      <select id="gender">
        <option value="male">–ú—É–∂—Å–∫–æ–π</option>
        <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
      </select>
    </div>
    <div class="group"><label>–û —Å–µ–±–µ</label><textarea id="bio" placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ..."></textarea></div>
    <button class="btn" onclick="saveProfile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="btn-logout" onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
  </div>

</div>

<div class="bottom-nav">
  <a href="/dashboard"><span>üî•</span>–°–≤–∞–π–ø–∏—Ç—å</a>
  <a href="#"><span>üíõ</span>–õ–∞–π–∫–∏</a>
  <a href="/chat"><span>üí¨</span>–ß–∞—Ç</a>
  <a href="/profile" class="active"><span>üë§</span>–ü—Ä–æ—Ñ–∏–ª—å</a>
</div>

<script>
const token = localStorage.getItem('token');
if(!token) window.location.href = '/login';
let activeSlot = 0;

async function loadProfile() {
  try {
    const res = await fetch('/users/me', {headers:{'Authorization':'Bearer '+token}});
    if(res.status===401){ window.location.href='/login'; return; }
    const user = await res.json();
    document.getElementById('profileName').textContent = user.name+', '+user.age;
    document.getElementById('profileCity').textContent = 'üìç '+(user.city||'');
    document.getElementById('name').value = user.name||'';
    document.getElementById('age').value = user.age||'';
    document.getElementById('bio').value = user.bio||'';
    document.getElementById('gender').value = user.gender||'male';
    const citySelect = document.getElementById('city');
    for(let opt of citySelect.options){ if(opt.value===user.city) opt.selected=true; }

    const days = Math.max(1, Math.floor((Date.now()-new Date(user.created_at))/86400000));
    document.getElementById('daysCount').textContent = days;

    if(user.photo && user.photo!=='default.jpg'){
      const hp = document.getElementById('heroPhoto');
      hp.innerHTML = '<img src="/static/uploads/'+user.photo+'">';
    } else {
      document.getElementById('heroEmoji').textContent = user.gender==='female'?'üë©':'üë®';
    }
  } catch(e){ console.log(e); }
}

async function uploadMainPhoto(input){
  const file = input.files[0];
  if(!file) return;
  const formData = new FormData();
  formData.append('file', file);
  const res = await fetch('/users/me/photo', {method:'POST', headers:{'Authorization':'Bearer '+token}, body:formData});
  if(res.ok) loadProfile();
}

function triggerSlot(slot){
  activeSlot = slot;
  document.getElementById('slotPhotoInput').click();
}

async function uploadSlotPhoto(input){
  const file = input.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(e){
    const slot = document.getElementById('slot'+activeSlot);
    slot.innerHTML = '<img src="'+e.target.result+'"><button class="del-btn" onclick="removeSlot(event,'+activeSlot+')">√ó</button>';
    updatePhotoCount();
  };
  reader.readAsDataURL(file);
  input.value='';
}

function removeSlot(e, slot){
  e.stopPropagation();
  const s = document.getElementById('slot'+slot);
  s.innerHTML = '<div class="plus">+</div>';
  s.onclick = function(){ triggerSlot(slot); };
  updatePhotoCount();
}

function updatePhotoCount(){
  const count = document.querySelectorAll('.photo-slot img').length;
  document.getElementById('photoCountText').textContent = count+'/6';
}

async function saveProfile(){
  const name = document.getElementById('name').value;
  const age = document.getElementById('age').value;
  const city = document.getElementById('city').value;
  const bio = document.getElementById('bio').value;
  const res = await fetch('/users/me?name='+encodeURIComponent(name)+'&age='+age+'&city='+encodeURIComponent(city)+'&bio='+encodeURIComponent(bio), {
    method:'PUT', headers:{'Authorization':'Bearer '+token}
  });
  if(res.ok){
    const el = document.getElementById('success');
    el.style.display='block';
    setTimeout(()=>el.style.display='none', 3000);
    loadProfile();
  }
}

function logout(){ localStorage.removeItem('token'); window.location.href='/'; }
loadProfile();
</script>
</body>
</html>