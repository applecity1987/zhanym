<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zhanym ‚Äî –°–æ–∑–¥–∞–π –∞–Ω–∫–µ—Ç—É</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#fff;min-height:100vh}
.progress{height:4px;background:#eee;position:fixed;top:0;left:0;right:0;z-index:100}
.progress-bar{height:100%;background:linear-gradient(135deg,#ff4458,#fd79a8);transition:.4s}
.top{display:flex;justify-content:space-between;align-items:center;padding:20px}
.btn-back{background:none;border:none;font-size:24px;cursor:pointer;color:#333}
.btn-skip{background:none;border:none;font-size:16px;color:#888;cursor:pointer}
.step{display:none;padding:0 25px 100px;max-width:500px;margin:0 auto}
.step.active{display:block}
.step h1{font-size:32px;font-weight:900;color:#1a1a1a;margin-bottom:10px;line-height:1.2}
.step p{color:#888;font-size:16px;margin-bottom:30px;line-height:1.6}

/* –¶–ï–õ–¨ */
.goal-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.goal-item{border:2px solid #eee;border-radius:16px;padding:20px 10px;text-align:center;cursor:pointer;transition:.2s}
.goal-item:hover{border-color:#ff4458;background:#fff5f5}
.goal-item.selected{border-color:#ff4458;background:#fff0f0}
.goal-icon{font-size:36px;margin-bottom:8px}
.goal-item p{font-size:13px;color:#333;margin:0}

/* –¢–ï–ì–ò */
.tags{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px}
.tag{padding:10px 18px;border:2px solid #eee;border-radius:50px;font-size:14px;cursor:pointer;transition:.2s;color:#333}
.tag:hover{border-color:#ff4458;color:#ff4458}
.tag.selected{background:linear-gradient(135deg,#ff4458,#fd79a8);color:white;border-color:transparent}

/* –§–û–¢–û */
.photo-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:20px}
.photo-slot{aspect-ratio:3/4;border:2px dashed #ddd;border-radius:16px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;background:#f9f9f9;transition:.2s}
.photo-slot:hover{border-color:#ff4458}
.photo-slot .plus{width:36px;height:36px;background:linear-gradient(135deg,#ff4458,#fd79a8);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:20px;font-weight:bold;position:absolute;bottom:8px;right:8px}
.photo-slot img{width:100%;height:100%;object-fit:cover}
.photo-count{color:#888;font-size:14px;display:flex;align-items:center;gap:10px;margin-bottom:20px}
.photo-count span{width:36px;height:36px;background:#f0f0f0;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#333}

/* –°–ï–ö–¶–ò–Ø –ü–†–ò–í–´–ß–ï–ö */
.habit-section{margin-bottom:25px;padding-bottom:25px;border-bottom:1px solid #eee}
.habit-section:last-child{border-bottom:none}
.habit-title{display:flex;align-items:center;gap:10px;font-size:17px;font-weight:bold;color:#1a1a1a;margin-bottom:15px}
.habit-title span{font-size:22px}

/* –ö–ù–û–ü–ö–ê –î–ê–õ–ï–ï */
.btn-next{position:fixed;bottom:30px;left:25px;right:25px;max-width:450px;margin:0 auto;padding:18px;background:linear-gradient(135deg,#ff4458,#fd79a8);color:white;border:none;border-radius:50px;font-size:18px;font-weight:bold;cursor:pointer;transition:.3s;display:block}
.btn-next:disabled{background:#eee;color:#aaa;cursor:not-allowed}
.btn-next:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,68,88,.4)}
.counter{color:#888;font-size:14px;margin-bottom:5px}
</style>
</head>
<body>

<div class="progress"><div class="progress-bar" id="progressBar" style="width:20%"></div></div>

<!-- –®–ê–ì 1: –¶–ï–õ–¨ -->
<div class="step active" id="step1">
  <div class="top"><button class="btn-back" onclick="goBack()">‚Äπ</button><span></span></div>
  <h1>–ß—Ç–æ —Ç—ã –∏—â–µ—à—å?</h1>
  <p>–ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ, –µ—Å–ª–∏ —ç—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è. –í Zhanym —Ç—ã –Ω–∞–π–¥—ë—à—å —Ç–æ, —á—Ç–æ –∏—â–µ—à—å.</p>
  <div class="goal-grid">
    <div class="goal-item" onclick="selectGoal(this,'partner')"><div class="goal-icon">üíò</div><p>–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä</p></div>
    <div class="goal-item" onclick="selectGoal(this,'both')"><div class="goal-icon">üòç</div><p>–î–æ–ª–≥–æ- –∏–ª–∏ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ</p></div>
    <div class="goal-item" onclick="selectGoal(this,'short')"><div class="goal-icon">ü•Ç</div><p>–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è</p></div>
    <div class="goal-item" onclick="selectGoal(this,'fun')"><div class="goal-icon">üéâ</div><p>–ü—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Å–µ–ª–∏—Ç—å—Å—è</p></div>
    <div class="goal-item" onclick="selectGoal(this,'friends')"><div class="goal-icon">üëã</div><p>–ù–∞–π—Ç–∏ –¥—Ä—É–∑–µ–π</p></div>
    <div class="goal-item" onclick="selectGoal(this,'unsure')"><div class="goal-icon">ü§î</div><p>–í—Å—ë –µ—â—ë —Ä–∞–∑–±–∏—Ä–∞—é—Å—å</p></div>
  </div>
  <button class="btn-next" id="btn1" disabled onclick="nextStep()">–î–∞–ª–µ–µ</button>
</div>

<!-- –®–ê–ì 2: –ü–†–ò–í–´–ß–ö–ò -->
<div class="step" id="step2">
  <div class="top"><button class="btn-back" onclick="goBack()">‚Äπ</button><button class="btn-skip" onclick="nextStep()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button></div>
  <h1>–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ–∏—Ö –ø—Ä–∏–≤—ã—á–∫–∞—Ö</h1>
  <p>–¢–≤–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ—Ö–æ–∂–∏ –Ω–∞ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–∞—Ä—ã? –£ —Ç–µ–±—è –ø—Ä–∞–≤–æ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–æ–≤–∞.</p>

  <div class="habit-section">
    <div class="habit-title"><span>üç∑</span> –ö–∞–∫ —á–∞—Å—Ç–æ —Ç—ã –ø—å—ë—à—å?</div>
    <div class="tags">
      <div class="tag" onclick="selectHabit(this,'drink')">–ù–µ –ø—å—é</div>
      <div class="tag" onclick="selectHabit(this,'drink')">–Ø –∑–∞ —Ç—Ä–µ–∑–≤–æ—Å—Ç—å</div>
      <div class="tag" onclick="selectHabit(this,'drink')">–ü–æ –æ—Å–æ–±—ã–º —Å–ª—É—á–∞—è–º</div>
      <div class="tag" onclick="selectHabit(this,'drink')">–ü–æ –≤—ã—Ö–æ–¥–Ω—ã–º</div>
      <div class="tag" onclick="selectHabit(this,'drink')">–ü–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –≤–µ—á–µ—Ä</div>
    </div>
  </div>

  <div class="habit-section">
    <div class="habit-title"><span>üö¨</span> –ö–∞–∫ —á–∞—Å—Ç–æ —Ç—ã –∫—É—Ä–∏—à—å?</div>
    <div class="tags">
      <div class="tag" onclick="selectHabit(this,'smoke')">–ù–µ –∫—É—Ä—é</div>
      <div class="tag" onclick="selectHabit(this,'smoke')">–ë—Ä–æ—Å–∞—é</div>
      <div class="tag" onclick="selectHabit(this,'smoke')">–ö—É—Ä—é –∑–∞ –∫–æ–º–ø–∞–Ω–∏—é</div>
      <div class="tag" onclick="selectHabit(this,'smoke')">–ö—É—Ä—é</div>
    </div>
  </div>

  <div class="habit-section">
    <div class="habit-title"><span>üèãÔ∏è</span> –ó–∞–Ω–∏–º–∞–µ—à—å—Å—è —Å–ø–æ—Ä—Ç–æ–º?</div>
    <div class="tags">
      <div class="tag" onclick="selectHabit(this,'sport')">–ö–∞–∂–¥—ã–π –¥–µ–Ω—å</div>
      <div class="tag" onclick="selectHabit(this,'sport')">–ß–∞—Å—Ç–æ</div>
      <div class="tag" onclick="selectHabit(this,'sport')">–ò–Ω–æ–≥–¥–∞</div>
      <div class="tag" onclick="selectHabit(this,'sport')">–ù–∏–∫–æ–≥–¥–∞</div>
    </div>
  </div>

  <div class="habit-section">
    <div class="habit-title"><span>üêæ</span> –£ —Ç–µ–±—è –µ—Å—Ç—å –ø–∏—Ç–æ–º—Ü—ã?</div>
    <div class="tags">
      <div class="tag" onclick="selectHabit(this,'pet')">–°–æ–±–∞–∫–∞</div>
      <div class="tag" onclick="selectHabit(this,'pet')">–ö–æ—à–∫–∞</div>
      <div class="tag" onclick="selectHabit(this,'pet')">–ü—Ç–∏—Ü–∞</div>
      <div class="tag" onclick="selectHabit(this,'pet')">–†—ã–±–∫–∏</div>
      <div class="tag" onclick="selectHabit(this,'pet')">–ß–µ—Ä–µ–ø–∞—Ö–∞</div>
      <div class="tag" onclick="selectHabit(this,'pet')">–•–æ–º—è–∫</div>
      <div class="tag" onclick="selectHabit(this,'pet')">–ù–µ—Ç –ø–∏—Ç–æ–º—Ü–µ–≤</div>
      <div class="tag" onclick="selectHabit(this,'pet')">–•–æ—á—É –ø–∏—Ç–æ–º—Ü–∞</div>
    </div>
  </div>

  <button class="btn-next" onclick="nextStep()">–î–∞–ª–µ–µ 0/4</button>
</div>

<!-- –®–ê–ì 3: –û –°–ï–ë–ï -->
<div class="step" id="step3">
  <div class="top"><button class="btn-back" onclick="goBack()">‚Äπ</button><button class="btn-skip" onclick="nextStep()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button></div>
  <h1>–ß—Ç–æ –µ—â—ë –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è ‚Äî —Ç–æ–±–æ–π?</h1>
  <p>–ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Å—è. –õ—é–¥—è–º –Ω—Ä–∞–≤–∏—Ç—Å—è –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å.</p>

  <div class="habit-section">
    <div class="habit-title"><span>üí¨</span> –¢–≤–æ–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è?</div>
    <div class="tags">
      <div class="tag" onclick="selectOne(this,'comm')">–ú–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—é—Å—å</div>
      <div class="tag" onclick="selectOne(this,'comm')">–û–±—â–∞—é—Å—å –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É</div>
      <div class="tag" onclick="selectOne(this,'comm')">–õ—é–±–ª—é –≤–∏–¥–µ–æ—á–∞—Ç—ã</div>
      <div class="tag" onclick="selectOne(this,'comm')">–õ—É—á—à–µ –≤—Å—Ç—Ä–µ—á—É—Å—å –ª–∏—á–Ω–æ</div>
    </div>
  </div>

  <div class="habit-section">
    <div class="habit-title"><span>‚ù§Ô∏è</span> –ö–∞–∫–∏–µ –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è –ª—é–±–≤–∏ –Ω—Ä–∞–≤—è—Ç—Å—è?</div>
    <div class="tags">
      <div class="tag" onclick="selectOne(this,'love')">–ñ–µ—Å—Ç—ã –≤–Ω–∏–º–∞–Ω–∏—è</div>
      <div class="tag" onclick="selectOne(this,'love')">–ü–æ–¥–∞—Ä–∫–∏</div>
      <div class="tag" onclick="selectOne(this,'love')">–ü—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è</div>
      <div class="tag" onclick="selectOne(this,'love')">–ö–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã</div>
      <div class="tag" onclick="selectOne(this,'love')">–í—Ä–µ–º—è –≤–º–µ—Å—Ç–µ</div>
    </div>
  </div>

  <div class="habit-section">
    <div class="habit-title"><span>üéì</span> –¢–≤–æ—ë –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ?</div>
    <div class="tags">
      <div class="tag" onclick="selectOne(this,'edu')">–°—Ä–µ–¥–Ω—è—è —à–∫–æ–ª–∞</div>
      <div class="tag" onclick="selectOne(this,'edu')">–¢–µ—Ö–Ω–∏–∫—É–º</div>
      <div class="tag" onclick="selectOne(this,'edu')">–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç</div>
      <div class="tag" onclick="selectOne(this,'edu')">–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞</div>
      <div class="tag" onclick="selectOne(this,'edu')">–ê—Å–ø–∏—Ä–∞–Ω—Ç—É—Ä–∞</div>
      <div class="tag" onclick="selectOne(this,'edu')">–î–æ–∫—Ç–æ—Ä –Ω–∞—É–∫</div>
    </div>
  </div>

  <div class="habit-section">
    <div class="habit-title"><span>üåô</span> –ó–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞?</div>
    <div class="tags">
      <div class="tag" onclick="selectOne(this,'zodiac')">–û–≤–µ–Ω</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–¢–µ–ª–µ—Ü</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–ë–ª–∏–∑–Ω–µ—Ü—ã</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–†–∞–∫</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–õ–µ–≤</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–î–µ–≤–∞</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–í–µ—Å—ã</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–°–∫–æ—Ä–ø–∏–æ–Ω</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–°—Ç—Ä–µ–ª–µ—Ü</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–ö–æ–∑–µ—Ä–æ–≥</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–í–æ–¥–æ–ª–µ–π</div>
      <div class="tag" onclick="selectOne(this,'zodiac')">–†—ã–±—ã</div>
    </div>
  </div>

  <button class="btn-next" onclick="nextStep()">–î–∞–ª–µ–µ</button>
</div>

<!-- –®–ê–ì 4: –ò–ù–¢–ï–†–ï–°–´ -->
<div class="step" id="step4">
  <div class="top"><button class="btn-back" onclick="goBack()">‚Äπ</button><button class="btn-skip" onclick="nextStep()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button></div>
  <h1>–ß–µ–º —Ç—ã —É–≤–ª–µ–∫–∞–µ—à—å—Å—è?</h1>
  <p>–£ —Ç–µ–±—è –µ—Å—Ç—å —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã. –ü–æ–¥–µ–ª–∏—Å—å –∏–º–∏ —Å –¥—Ä—É–≥–∏–º–∏.</p>
  <div class="counter" id="interestCount">–í—ã–±—Ä–∞–Ω–æ: 0/10</div>
  <div class="tags" id="interestTags">
    <div class="tag" onclick="selectInterest(this)">‚òï –ö–æ—Ñ–µ</div>
    <div class="tag" onclick="selectInterest(this)">‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</div>
    <div class="tag" onclick="selectInterest(this)">üìö –ß—Ç–µ–Ω–∏–µ</div>
    <div class="tag" onclick="selectInterest(this)">üéÆ –ò–≥—Ä—ã</div>
    <div class="tag" onclick="selectInterest(this)">üéµ –ú—É–∑—ã–∫–∞</div>
    <div class="tag" onclick="selectInterest(this)">üèÉ –°–ø–æ—Ä—Ç</div>
    <div class="tag" onclick="selectInterest(this)">üçï –ï–¥–∞</div>
    <div class="tag" onclick="selectInterest(this)">üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ</div>
    <div class="tag" onclick="selectInterest(this)">üé≠ –¢–µ–∞—Ç—Ä</div>
    <div class="tag" onclick="selectInterest(this)">üèîÔ∏è –ì–æ—Ä—ã</div>
    <div class="tag" onclick="selectInterest(this)">üßò –ô–æ–≥–∞</div>
    <div class="tag" onclick="selectInterest(this)">üé¨ –ö–∏–Ω–æ</div>
    <div class="tag" onclick="selectInterest(this)">üêï –ñ–∏–≤–æ—Ç–Ω—ã–µ</div>
    <div class="tag" onclick="selectInterest(this)">üç≥ –ö—É–ª–∏–Ω–∞—Ä–∏—è</div>
    <div class="tag" onclick="selectInterest(this)">üì∏ –§–æ—Ç–æ</div>
    <div class="tag" onclick="selectInterest(this)">üö¥ –í–µ–ª–æ—Å–ø–æ—Ä—Ç</div>
    <div class="tag" onclick="selectInterest(this)">üé∏ –ì–∏—Ç–∞—Ä–∞</div>
    <div class="tag" onclick="selectInterest(this)">üíÉ –¢–∞–Ω—Ü—ã</div>
    <div class="tag" onclick="selectInterest(this)">üèÑ –°—ë—Ä—Ñ–∏–Ω–≥</div>
    <div class="tag" onclick="selectInterest(this)">‚õ∑Ô∏è –õ—ã–∂–∏</div>
    <div class="tag" onclick="selectInterest(this)">üß© –ù–∞—Å—Ç–æ–ª–∫–∏</div>
    <div class="tag" onclick="selectInterest(this)">üé§ –ö–∞—Ä–∞–æ–∫–µ</div>
    <div class="tag" onclick="selectInterest(this)">üåø –ü—Ä–∏—Ä–æ–¥–∞</div>
    <div class="tag" onclick="selectInterest(this)">üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</div>
    <div class="tag" onclick="selectInterest(this)">üèãÔ∏è –§–∏—Ç–Ω–µ—Å</div>
    <div class="tag" onclick="selectInterest(this)">üé™ –§–µ—Å—Ç–∏–≤–∞–ª–∏</div>
    <div class="tag" onclick="selectInterest(this)">üç£ –°—É—à–∏</div>
    <div class="tag" onclick="selectInterest(this)">üßÅ –í—ã–ø–µ—á–∫–∞</div>
    <div class="tag" onclick="selectInterest(this)">üéØ –ë–æ—É–ª–∏–Ω–≥</div>
    <div class="tag" onclick="selectInterest(this)">üèä –ü–ª–∞–≤–∞–Ω–∏–µ</div>
  </div>
  <button class="btn-next" id="btn4" onclick="nextStep()">–î–∞–ª–µ–µ 0/10</button>
</div>

<!-- –®–ê–ì 5: –§–û–¢–û -->
<div class="step" id="step5">
  <div class="top"><button class="btn-back" onclick="goBack()">‚Äπ</button></div>
  <h1>–î–æ–±–∞–≤—å —Å–≤–æ–∏ —Ñ–æ—Ç–æ</h1>
  <p>–ü—Ä–æ—Ñ–∏–ª–∏ —Å —Ñ–æ—Ç–æ –ø–æ–ª—É—á–∞—é—Ç –≤ 10 —Ä–∞–∑ –±–æ–ª—å—à–µ –ª–∞–π–∫–æ–≤!</p>
  <div class="photo-count"><span id="photoCountNum">0</span> –∏–∑ 6 —Ñ–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ</div>
  <div class="photo-grid">
    <div class="photo-slot" onclick="triggerPhoto(0)" id="slot0"><div class="plus">+</div></div>
    <div class="photo-slot" onclick="triggerPhoto(1)" id="slot1"><div class="plus">+</div></div>
    <div class="photo-slot" onclick="triggerPhoto(2)" id="slot2"><div class="plus">+</div></div>
    <div class="photo-slot" onclick="triggerPhoto(3)" id="slot3"><div class="plus">+</div></div>
    <div class="photo-slot" onclick="triggerPhoto(4)" id="slot4"><div class="plus">+</div></div>
    <div class="photo-slot" onclick="triggerPhoto(5)" id="slot5"><div class="plus">+</div></div>
  </div>
  <input type="file" id="photoInput" accept="image/*" style="display:none" onchange="handlePhoto(event)">
  <button class="btn-next" id="btn5" onclick="finish()">–î–∞–ª–µ–µ 0/6</button>
</div>

<script>
let currentStep = 1;
let totalSteps = 5;
let selectedGoal = null;
let interestCount = 0;
let photoCount = 0;
let activePhotoSlot = 0;
const token = localStorage.getItem('token');
if(!token) window.location.href = '/login';

function updateProgress(){
  document.getElementById('progressBar').style.width = (currentStep/totalSteps*100)+'%';
}

function nextStep(){
  if(currentStep < totalSteps){
    document.getElementById('step'+currentStep).classList.remove('active');
    currentStep++;
    document.getElementById('step'+currentStep).classList.add('active');
    updateProgress();
    window.scrollTo(0,0);
  }
}

function goBack(){
  if(currentStep > 1){
    document.getElementById('step'+currentStep).classList.remove('active');
    currentStep--;
    document.getElementById('step'+currentStep).classList.add('active');
    updateProgress();
  } else {
    window.location.href = '/dashboard';
  }
}

function selectGoal(el, goal){
  document.querySelectorAll('.goal-item').forEach(i=>i.classList.remove('selected'));
  el.classList.add('selected');
  selectedGoal = goal;
  document.getElementById('btn1').disabled = false;
}

function selectHabit(el, group){
  const siblings = el.parentElement.querySelectorAll('.tag');
  siblings.forEach(t=>t.classList.remove('selected'));
  el.classList.add('selected');
  updateHabitBtn();
}

function selectOne(el, group){
  const container = el.closest('.habit-section');
  container.querySelectorAll('.tag').forEach(t=>t.classList.remove('selected'));
  el.classList.add('selected');
}

function updateHabitBtn(){
  const selected = document.querySelectorAll('#step2 .tag.selected').length;
  document.querySelector('#step2 .btn-next').textContent = '–î–∞–ª–µ–µ '+selected+'/4';
}

function selectInterest(el){
  if(el.classList.contains('selected')){
    el.classList.remove('selected');
    interestCount--;
  } else {
    if(interestCount >= 10) return;
    el.classList.add('selected');
    interestCount++;
  }
  document.getElementById('interestCount').textContent = '–í—ã–±—Ä–∞–Ω–æ: '+interestCount+'/10';
  document.getElementById('btn4').textContent = '–î–∞–ª–µ–µ '+interestCount+'/10';
}

function triggerPhoto(slot){
  activePhotoSlot = slot;
  document.getElementById('photoInput').click();
}

function handlePhoto(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    const slot = document.getElementById('slot'+activePhotoSlot);
    slot.innerHTML = '<img src="'+ev.target.result+'"><div class="plus" style="background:rgba(255,0,0,.7)" onclick="removePhoto(event,'+activePhotoSlot+')">√ó</div>';
    photoCount++;
    document.getElementById('photoCountNum').textContent = photoCount;
    document.getElementById('btn5').textContent = '–î–∞–ª–µ–µ '+photoCount+'/6';
  };
  reader.readAsDataURL(file);
  e.target.value = '';
}

function removePhoto(e, slot){
  e.stopPropagation();
  const s = document.getElementById('slot'+slot);
  s.innerHTML = '<div class="plus">+</div>';
  s.onclick = function(){ triggerPhoto(slot); };
  photoCount--;
  document.getElementById('photoCountNum').textContent = photoCount;
  document.getElementById('btn5').textContent = '–î–∞–ª–µ–µ '+photoCount+'/6';
}

async function finish(){
  const selected = {
    goal: selectedGoal,
    drink: getSelected('step2', 'drink'),
    smoke: getSelected('step2', 'smoke'),
    sport: getSelected('step2', 'sport'),
    pet: getSelected('step2', 'pet'),
    communication: getSelected('step3', 'comm'),
    love_language: getSelected('step3', 'love'),
    education: getSelected('step3', 'edu'),
    zodiac: getSelected('step3', 'zodiac'),
    interests: getInterests()
  };

  let params = new URLSearchParams();
  for(let key in selected){ if(selected[key]) params.append(key, selected[key]); }

  try {
    await fetch('/users/me/onboarding?'+params.toString(), {
      method:'PUT',
      headers:{'Authorization':'Bearer '+token}
    });
  } catch(e){ console.log(e); }

  window.location.href = '/dashboard';
}

function getSelected(stepId, group){
  const step = document.getElementById(stepId);
  const tags = step.querySelectorAll('.tag.selected');
  for(let tag of tags){
    if(tag.getAttribute('onclick') && tag.getAttribute('onclick').includes("'"+group+"'")){
      return tag.textContent.trim();
    }
  }
  return null;
}

function getInterests(){
  const selected = document.querySelectorAll('#step4 .tag.selected');
  return Array.from(selected).map(t=>t.textContent.trim()).join(',');
}
}
</script>
</body>
</html>